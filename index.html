<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>QuickSupport Bot Status</title>
   <style>
      body {
         font-family: Arial, sans-serif;
         margin: 0;
         padding: 0;
         background-color: #121212;
         color: #e0e0e0;
         line-height: 1.6;
      }
      header {
         background-color: #1f2937;
         text-align: center;
         padding: 15px 20px;
      }
      header h1 {
         margin: 0;
         font-size: 1.8rem;
      }
      main {
         margin: 20px;
      }
      .button-container {
         display: flex;
         justify-content: center;
         align-items: center;
         gap: 15px;
         flex-wrap: wrap;
         margin: 20px 0;
      }
      .search-bar {
         padding: 10px;
         font-size: 1rem;
         border: 1px solid #ccc;
         border-radius: 5px;
         width: 250px;
         background-color: #333;
         color: #e0e0e0;
      }
      .search-bar:focus {
         outline: none;
         border-color: #4caf50;
      }
      .button {
         padding: 10px 20px;
         font-size: 1rem;
         color: #fff;
         background-color: #4caf50;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         transition: background-color 0.3s ease;
      }
      .button:hover {
         background-color: #45a049;
      }
      .refresh-info {
         text-align: center;
         margin: 15px 0;
         font-size: 1.1rem;
      }
      .refresh-info span {
         font-weight: bold;
         color: #ff9800;
      }
      .legend {
         text-align: center;
         font-size: 0.9rem;
         color: #cfd8dc;
         margin-bottom: 10px;
      }
      .table-wrapper {
         overflow-x: auto;
         margin: 20px auto;
         max-width: 95%;
         border-radius: 8px;
      }
      table {
         width: 100%;
         border-collapse: collapse;
         text-align: center;
         background-color: #1e1e1e;
         color: #e0e0e0;
      }
      th, td {
         padding: 12px;
         border: 1px solid #374151;
      }
      th {
         background-color: #374151;
         font-weight: bold;
      }
      .status-up {
         color: #4caf50;
         font-weight: bold;
      }
      .status-down {
         color: #f44336;
         font-weight: bold;
      }
      .public {
         background-color: #374672; /* Blue for Public Bot */
      }
      .private {
         background-color: #615175; /* Purple for Private Bot */
      }
      @media (max-width: 768px) {
         .search-bar {
            width: 100%;
         }
         table {
            font-size: 0.9rem;
         }
         th, td {
            padding: 10px;
         }
      }
   </style>
</head>
<body>
   <header>
      <h1>QuickSupport Bot Status</h1>
   </header>
   <main>
      <section class="button-container">
         <input type="text" id="searchBar" class="search-bar" placeholder="Enter server ID..." aria-label="Search server by ID" />
         <button class="button" id="searchButton" aria-label="Search for the server">Search</button>
         <button class="button" id="viewAllButton" aria-label="Reset the search">Reset</button>
      </section>
      <section class="refresh-info">
         Next data refresh in <span id="countdown" aria-live="polite">0:00</span> minutes
      </section>
      <div class="legend">ðŸŸ¦ Public Bot | ðŸŸª Private Bot</div>
      <section class="table-wrapper">
         <table aria-label="Bot status information">
            <thead>
               <tr>
                  <th>Bot ID</th>
                  <th>Shard ID</th>
                  <th>Last Updated</th>
                  <th>Last Uptime</th>
                  <th>Cached Guilds</th>
                  <th>Cached Users</th>
                  <th>Current Latency</th>
                  <th>Status</th>
               </tr>
            </thead>
            <tbody id="statusTable">
               <tr>
                  <td colspan="8">Loading data...</td>
               </tr>
            </tbody>
         </table>
      </section>
   </main>
   <script>
      document.addEventListener("DOMContentLoaded", () => {
         const statusTable = document.getElementById("statusTable");
         const countdownElement = document.getElementById("countdown");
         const searchBar = document.getElementById("searchBar");
         const searchButton = document.getElementById("searchButton");
         const viewAllButton = document.getElementById("viewAllButton");
         const refreshInterval = 300000;
         let nextRefresh = Date.now() + refreshInterval;

         const formatTime = (ms) => {
            const minutes = Math.floor(ms / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            return `${minutes}:${seconds.toString().padStart(2, "0")}`;
         };

         const updateCountdown = () => {
            const now = Date.now();
            const timeRemaining = nextRefresh - now;
            countdownElement.textContent = formatTime(Math.max(timeRemaining, 0));
            if (timeRemaining <= 0) {
               fetchBotData();
               nextRefresh += refreshInterval;
            }
         };

         const fetchBotData = async () => {
            const serverId = searchBar.value.trim();
            const apiUrl = `https://status.faizo.top/api/quicksupport/${serverId}`;
            
            statusTable.innerHTML = `<tr><td colspan="8">Loading data...</td></tr>`;
            
            try {
               const response = await fetch(apiUrl);
               const data = await response.json();
               statusTable.innerHTML = data.length
                  ? data.map(bot => generateBotRow(bot)).join("")
                  : `<tr><td colspan="8">No data found.</td></tr>`;
            } catch {
               statusTable.innerHTML = `<tr><td colspan="8">Error loading data. Please try again later.</td></tr>`;
            }
         };

         const generateBotRow = (bot) => {
            const isPublic = String(bot.bot_id) === "1280984633739186318";
            return `
               <tr class="${isPublic ? "public" : "private"}">
                  <td>${bot.bot_id}</td>
                  <td>${bot.shard_id}</td>
                  <td>${timeAgo(bot.last_updated)}</td>
                  <td>${timeAgo(bot.last_uptime)}</td>
                  <td>${bot.cached_guilds}</td>
                  <td>${bot.cached_users}</td>
                  <td>${bot.current_latency} ms</td>
                  <td><span class="${bot.is_online ? "status-up" : "status-down"}">${bot.is_online ? "Online" : "Offline"}</span></td>
               </tr>
            `;
         };

         const timeAgo = (timestamp) => {
            const ms = Date.now() - timestamp;
            const units = [
               { label: "week", value: 604800000 },
               { label: "day", value: 86400000 },
               { label: "hour", value: 3600000 },
               { label: "minute", value: 60000 },
               { label: "second", value: 1000 },
            ];
            for (const { label, value } of units) {
               const amount = Math.floor(ms / value);
               if (amount > 0) return `${amount} ${label}${amount > 1 ? "s" : ""} ago`;
            }
            return "just now";
         };

         searchButton.addEventListener("click", () => {
            const serverId = searchBar.value.trim();
            if (/^\d+$/.test(serverId)) fetchBotData();
            else alert("Please enter a valid Discord server ID with only digits.");
         });

         viewAllButton.addEventListener("click", () => {
            searchBar.value = "";
            fetchBotData();
         });

         fetchBotData();
         setInterval(updateCountdown, 1000);
      });
   </script>
</body>
</html>
